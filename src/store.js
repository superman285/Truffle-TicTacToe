import Vue from "vue";
import Vuex from "vuex";

Vue.use(Vuex);

export default new Vuex.Store({
  state: {
    gameCost: "0.1 ETH",
    gameBonuspool: "0.2 ETH",
    web3: {},
    contractABI: [
      {
        "constant": true,
        "inputs": [],
        "name": "gameResult",
        "outputs": [
          {
            "name": "",
            "type": "string"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0x7152f800"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "activePlayer",
        "outputs": [
          {
            "name": "",
            "type": "address"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0x7fdffd23"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "hostPlayer",
        "outputs": [
          {
            "name": "",
            "type": "address"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0x8039ed53"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "victorPlayer",
        "outputs": [
          {
            "name": "",
            "type": "address"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0xb6ff6a52"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "gameCost",
        "outputs": [
          {
            "name": "",
            "type": "uint256"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0xcab896dc"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "guestPlayer",
        "outputs": [
          {
            "name": "",
            "type": "address"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0xdfeada94"
      },
      {
        "inputs": [],
        "payable": true,
        "stateMutability": "payable",
        "type": "constructor",
        "signature": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "creatorAddr",
            "type": "address"
          }
        ],
        "name": "GameCreated",
        "type": "event",
        "signature": "0x4f0d1d413a983b9df8ab6ab954635b186a1e9a09ee6dc1b43263ddbf48412267"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "playerAddr",
            "type": "address"
          }
        ],
        "name": "PlayerJoined",
        "type": "event",
        "signature": "0x31e760aa525306aba638a784082a013b6a1cc0a9a1789f3f22281c0453b10b1f"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "activePlayerAddr",
            "type": "address"
          }
        ],
        "name": "ActivePlayer",
        "type": "event",
        "signature": "0x95975a5cac9ad4b5953c1419a5f954acbb5ca210ae91a6f3e365cdd108e81740"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "gameResult",
            "type": "string"
          },
          {
            "indexed": false,
            "name": "victor",
            "type": "address"
          }
        ],
        "name": "GameFinished",
        "type": "event",
        "signature": "0x8faeeac76a6e18b7d45e0ec2ae51d949cc784f877b0c55bbc21157f141d61cc8"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "receiver",
            "type": "address"
          },
          {
            "indexed": false,
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "VictoryAward",
        "type": "event",
        "signature": "0x6ae495f483891de86c9e2a648b5510f7db2f2dfc77617fedffb8de30765735cb"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "getWholeBoard",
        "outputs": [
          {
            "name": "",
            "type": "string[3][3]"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0xd59d31ac"
      },
      {
        "constant": false,
        "inputs": [],
        "name": "joinGame",
        "outputs": [],
        "payable": true,
        "stateMutability": "payable",
        "type": "function",
        "signature": "0xd4f77b1c"
      },
      {
        "constant": false,
        "inputs": [],
        "name": "restartGame",
        "outputs": [],
        "payable": true,
        "stateMutability": "payable",
        "type": "function",
        "signature": "0x8d25af04"
      },
      {
        "constant": true,
        "inputs": [],
        "name": "getBonuspool",
        "outputs": [
          {
            "name": "",
            "type": "uint256"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function",
        "signature": "0x6cc1e88e"
      },
      {
        "constant": false,
        "inputs": [
          {
            "name": "row",
            "type": "uint8"
          },
          {
            "name": "column",
            "type": "uint8"
          }
        ],
        "name": "setChess",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function",
        "signature": "0x5aff77a0"
      }
    ],
    //ganache privateNet deploy with truffle
    //contractAddr: "0xB4e112E9AAb55A3F93100114543627C8482dadF7",
    //rinkeby deploy with truffle
    contractAddr: "0xfC26E0B10D67CC8F89667fACd94fb87634a6b1D2",
    contractObj: {},
    hostPlayer: "",
    guestPlayer: "",
    chessBoard: [["","",""],["","",""],["","",""]],
    activePlayer: "",
    gameState: {
      gameFinished: false,
      gameResult: ""
    }
  },
  getters: {
    currentAccount: state => {
      return window.ethereum.selectedAddress;
    },
    activeTurn: state=>{
      switch (state.activePlayer.toLowerCase()) {
        case "":
          return "Waiting..."
          break;
        case state.hostPlayer.toLowerCase():
          return "HostPlayer's Turn";
          break;
        case state.guestPlayer.toLowerCase():
          return "GuestPlayer's Turn";
          break;
        default:
          return "Waiting...";
      }
    }
  },
  mutations: {
    setHostPlayer(state, payload) {
      state.hostPlayer = payload;
    },
    setGuestPlayer(state, payload) {
      this.state.guestPlayer = payload;
    },
    setContractObj(state,payload) {
      state.contractObj = payload;
    }
  },
  actions: {
    getContractObj() {
      let web3 = this.state.web3;
      let contractObj = new web3.eth.Contract(
        this.state.contractABI,
        this.state.contractAddr
      );
      return contractObj;
    },

    async getWholeBoard(store) {
      let web3 = store.state.web3;
      let contractObj = store.state.contractObj;
      let wholeboard = await contractObj.methods.getWholeBoard.call();
      return wholeboard;
    },
    async getBonuspool(store) {
      let contractObj = store.state.contractObj;
      let bonuspool = await contractObj.methods.getBonuspool.call();
      let fixedbonuspool = (bonuspool / 10 ** 18).toFixed(1);
      return fixedbonuspool;
    },

    async createGame(store) {
      let contractObj = await store.dispatch("getContractObj");
      let from = store.getters.currentAccount;
      let web3 = store.state.web3;
      let newContractObj = await contractObj
        .deploy({
          data: "0x608060405260038060156101000a81548160ff021916908360ff16021790555067016345785d8a0000341415156200006e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000065906200030f565b60405180910390fd5b6000600360146101000a81548160ff021916908315150217905550336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506040805190810160405280600181526020017f4f00000000000000000000000000000000000000000000000000000000000000815250600d60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020908051906020019062000174929190620001d5565b507f4f0d1d413a983b9df8ab6ab954635b186a1e9a09ee6dc1b43263ddbf484122676000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16604051620001c79190620002f2565b60405180910390a16200038d565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200021857805160ff191683800117855562000249565b8280016001018555821562000249579182015b82811115620002485782518255916020019190600101906200022b565b5b5090506200025891906200025c565b5090565b6200028191905b808211156200027d57600081600090555060010162000263565b5090565b90565b6200028f8162000351565b82525050565b6000602d82527f63726561746f72206d7573742073656e642067616d65436f737420746f20637260208301527f65617465207468652067616d65000000000000000000000000000000000000006040830152606082019050919050565b600060208201905062000309600083018462000284565b92915050565b600060208201905081810360008301526200032a8162000295565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200035e8262000365565b9050919050565b6000620003728262000379565b9050919050565b6000620003868262000331565b9050919050565b613385806200039d6000396000f3fe6080604052600436106100af576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680635aff77a0146100b45780636cc1e88e146100dd5780637152f800146101085780637fdffd23146101335780638039ed531461015e5780638d25af0414610189578063b6ff6a5214610193578063cab896dc146101be578063d4f77b1c146101e9578063d59d31ac146101f3578063dfeada941461021e575b600080fd5b3480156100c057600080fd5b506100db60048036036100d69190810190612aea565b610249565b005b3480156100e957600080fd5b506100f2610813565b6040516100ff91906131fa565b60405180910390f35b34801561011457600080fd5b5061011d610832565b60405161012a9190613068565b60405180910390f35b34801561013f57600080fd5b506101486108d0565b6040516101559190613002565b60405180910390f35b34801561016a57600080fd5b506101736108f6565b6040516101809190613002565b60405180910390f35b61019161091b565b005b34801561019f57600080fd5b506101a8610cd8565b6040516101b59190612fcc565b60405180910390f35b3480156101ca57600080fd5b506101d3610cfe565b6040516101e091906131fa565b60405180910390f35b6101f1610d0a565b005b3480156101ff57600080fd5b506102086111bb565b6040516102159190613046565b60405180910390f35b34801561022a57600080fd5b506102336112d0565b6040516102409190613002565b60405180910390f35b600360149054906101000a900460ff16151561029a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610291906131da565b60405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561032c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610323906130ba565b60405180910390fd5b60038260ff16108015610342575060038160ff16105b1515610383576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161037a9061315a565b60405180910390fd5b6040516020018060000190506040516020818303038152906040528051906020012060048360ff166003811015156103b757fe5b600302018260ff166003811015156103cb57fe5b01604051602001808280546001816001161561010002031660029004801561042a5780601f1061040857610100808354040283529182019161042a565b820191906000526020600020905b815481529060010190602001808311610416575b505091505060405160208183030381529060405280519060200120141515610487576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161047e9061313a565b60405180910390fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156105e2576040805190810160405280600181526020017f4f0000000000000000000000000000000000000000000000000000000000000081525060048360ff1660038110151561052457fe5b600302018260ff1660038110151561053857fe5b01908051906020019061054c92919061292c565b50600e60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081819054906101000a900460ff168092919060010191906101000a81548160ff021916908360ff160217905550506106e5565b6040805190810160405280600181526020017f580000000000000000000000000000000000000000000000000000000000000081525060048360ff1660038110151561062a57fe5b600302018260ff1660038110151561063e57fe5b01908051906020019061065292919061292c565b50600e6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081819054906101000a900460ff168092919060010191906101000a81548160ff021916908360ff160217905550505b60016002600360159054906101000a900460ff16020360ff16600e6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16600e60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff160160ff161015156107f1576107f082826112f6565b5b600360149054906101000a900460ff161561080f5761080e612232565b5b5050565b60003073ffffffffffffffffffffffffffffffffffffffff1631905090565b600f8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108c85780601f1061089d576101008083540402835291602001916108c8565b820191906000526020600020905b8154815290600101906020018083116108ab57829003601f168201915b505050505081565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156109ac576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109a3906130fa565b60405180910390fd5b600360149054906101000a900460ff16158015610a185750600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b1515610a59576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a509061319a565b60405180910390fd5b67016345785d8a000034141515610aa5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a9c9061311a565b60405180910390fd5b600e60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81549060ff0219169055600e6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81549060ff0219169055600d6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000610bf391906129ac565b600160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600260006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905560046000610c4b91906129f4565b600360006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600f6000610c7e91906129ac565b7f4f0d1d413a983b9df8ab6ab954635b186a1e9a09ee6dc1b43263ddbf484122676000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16604051610cce9190612fe7565b60405180910390a1565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b67016345785d8a000081565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151515610d9c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d93906131ba565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141515610e2f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e269061317a565b60405180910390fd5b67016345785d8a000034141515610e7b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e72906130da565b60405180910390fd5b33600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f31e760aa525306aba638a784082a013b6a1cc0a9a1789f3f22281c0453b10b1f600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16604051610f0d9190612fe7565b60405180910390a16001600360146101000a81548160ff0219169083151502179055506040805190810160405280600181526020017f5800000000000000000000000000000000000000000000000000000000000000815250600d6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209080519060200190610fda92919061292c565b506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1661101b612448565b73ffffffffffffffffffffffffffffffffffffffff16141561109e576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550611160565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166110df612448565b73ffffffffffffffffffffffffffffffffffffffff16141561115f57600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b7f95975a5cac9ad4b5953c1419a5f954acbb5ca210ae91a6f3e365cdd108e81740600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040516111b19190612fe7565b60405180910390a1565b6111c3612a27565b6004600380602002604051908101604052809291906000905b828210156112c757838260030201600380602002604051908101604052809291906000905b828210156112b4578382018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112a05780601f10611275576101008083540402835291602001916112a0565b820191906000526020600020905b81548152906001019060200180831161128357829003601f168201915b505050505081526020019060010190611201565b50505050815260200190600101906111dc565b50505050905090565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080600080915091505b600360159054906101000a900460ff1660ff168260ff1610156114fb57600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405160200180828054600181600116156101000203166002900480156113dd5780601f106113bb5761010080835404028352918201916113dd565b820191906000526020600020905b8154815290600101906020018083116113c9575b50509150506040516020818303038152906040528051906020012060048360ff1660038110151561140a57fe5b600302018460ff1660038110151561141e57fe5b01604051602001808280546001816001161561010002031660029004801561147d5780601f1061145b57610100808354040283529182019161147d565b820191906000526020600020905b815481529060010190602001808311611469575b50509150506040516020818303038152906040528051906020012014156114e957808060010191505060038160ff1614156114e4576114dd600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166124e9565b505061222e565b6114ee565b6114fb565b8180600101925050611301565b5050600080600080915091505b600360159054906101000a900460ff1660ff168260ff16101561170257600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405160200180828054600181600116156101000203166002900480156115e45780601f106115c25761010080835404028352918201916115e4565b820191906000526020600020905b8154815290600101906020018083116115d0575b50509150506040516020818303038152906040528051906020012060048560ff1660038110151561161157fe5b600302018360ff1660038110151561162557fe5b0160405160200180828054600181600116156101000203166002900480156116845780601f10611662576101008083540402835291820191611684565b820191906000526020600020905b815481529060010190602001808311611670575b50509150506040516020818303038152906040528051906020012014156116f057808060010191505060038160ff1614156116eb576116e4600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166124e9565b505061222e565b6116f5565b611702565b8180600101925050611508565b5050600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405160200180828054600181600116156101000203166002900480156117c35780601f106117a15761010080835404028352918201916117c3565b820191906000526020600020905b8154815290600101906020018083116117af575b505091505060405160208183030381529060405280519060200120600460006003811015156117ee57fe5b60030201600160038110151561180057fe5b01604051602001808280546001816001161561010002031660029004801561185f5780601f1061183d57610100808354040283529182019161185f565b820191906000526020600020905b81548152906001019060200180831161184b575b505091505060405160208183030381529060405280519060200120141580156119fc5750600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405160200180828054600181600116156101000203166002900480156119425780601f10611920576101008083540402835291820191611942565b820191906000526020600020905b81548152906001019060200180831161192e575b5050915050604051602081830303815290604052805190602001206004600160038110151561196d57fe5b60030201600060038110151561197f57fe5b0160405160200180828054600181600116156101000203166002900480156119de5780601f106119bc5761010080835404028352918201916119de565b820191906000526020600020905b8154815290600101906020018083116119ca575b50509150506040516020818303038152906040528051906020012014155b8015611b7c5750600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040516020018082805460018160011615610100020316600290048015611ac25780601f10611aa0576101008083540402835291820191611ac2565b820191906000526020600020905b815481529060010190602001808311611aae575b50509150506040516020818303038152906040528051906020012060046001600381101515611aed57fe5b600302016002600381101515611aff57fe5b016040516020018082805460018160011615610100020316600290048015611b5e5780601f10611b3c576101008083540402835291820191611b5e565b820191906000526020600020905b815481529060010190602001808311611b4a575b50509150506040516020818303038152906040528051906020012014155b8015611cfc5750600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040516020018082805460018160011615610100020316600290048015611c425780601f10611c20576101008083540402835291820191611c42565b820191906000526020600020905b815481529060010190602001808311611c2e575b50509150506040516020818303038152906040528051906020012060046002600381101515611c6d57fe5b600302016001600381101515611c7f57fe5b016040516020018082805460018160011615610100020316600290048015611cde5780601f10611cbc576101008083540402835291820191611cde565b820191906000526020600020905b815481529060010190602001808311611cca575b50509150506040516020818303038152906040528051906020012014155b1561212457600080600080915091505b600360159054906101000a900460ff1660ff168260ff161015611f0657600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040516020018082805460018160011615610100020316600290048015611de85780601f10611dc6576101008083540402835291820191611de8565b820191906000526020600020905b815481529060010190602001808311611dd4575b50509150506040516020818303038152906040528051906020012060048360ff16600381101515611e1557fe5b600302018360ff16600381101515611e2957fe5b016040516020018082805460018160011615610100020316600290048015611e885780601f10611e66576101008083540402835291820191611e88565b820191906000526020600020905b815481529060010190602001808311611e74575b5050915050604051602081830303815290604052805190602001201415611ef457808060010191505060038160ff161415611eef57611ee8600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166124e9565b505061222e565b611ef9565b611f06565b8180600101925050611d0c565b5050600080600080915091505b600360159054906101000a900460ff1660ff168260ff16101561212157600d6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040516020018082805460018160011615610100020316600290048015611fef5780601f10611fcd576101008083540402835291820191611fef565b820191906000526020600020905b815481529060010190602001808311611fdb575b50509150506040516020818303038152906040528051906020012060048360ff1660038110151561201c57fe5b60030201600184600360159054906101000a900460ff16030360ff1660038110151561204457fe5b0160405160200180828054600181600116156101000203166002900480156120a35780601f106120815761010080835404028352918201916120a3565b820191906000526020600020905b81548152906001019060200180831161208f575b505091505060405160208183030381529060405280519060200120141561210f57808060010191505060038160ff16141561210a57612103600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166124e9565b505061222e565b612114565b612121565b8180600101925050611f13565b50505b6002600360159054906101000a900460ff1660ff160a60ff16600e6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16600e60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff160160ff16141561222d5761222c612748565b5b5b5050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561231157600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506123ed565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614156123ec576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b7f95975a5cac9ad4b5953c1419a5f954acbb5ca210ae91a6f3e365cdd108e81740600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660405161243e9190612fe7565b60405180910390a1565b600080600242436040516020018083815260200182815260200192505050604051602081830303815290604052805190602001206001900481151561248957fe5b06905060008114156124bf576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff169150506124e6565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169150505b90565b6000600360146101000a81548160ff02191690831515021790555080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614156125eb576040805190810160405280600b81526020017f686f7374566963746f7279000000000000000000000000000000000000000000815250600f90805190602001906125e592919061292c565b50612638565b6040805190810160405280600c81526020017f6775657374566963746f72790000000000000000000000000000000000000000815250600f908051906020019061263692919061292c565b505b600260006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690557f8faeeac76a6e18b7d45e0ec2ae51d949cc784f877b0c55bbc21157f141d61cc8600f8260405161268f92919061308a565b60405180910390a17f6ae495f483891de86c9e2a648b5510f7db2f2dfc77617fedffb8de30765735cb813073ffffffffffffffffffffffffffffffffffffffff16316040516126df92919061301d565b60405180910390a18073ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f19350505050158015612744573d6000803e3d6000fd5b5050565b6000600360146101000a81548160ff0219169083151502179055506040805190810160405280600381526020017f7469650000000000000000000000000000000000000000000000000000000000815250600f90805190602001906127ae92919061292c565b50600260006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690557f8faeeac76a6e18b7d45e0ec2ae51d949cc784f877b0c55bbc21157f141d61cc8600f600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660405161282892919061308a565b60405180910390a1600060023073ffffffffffffffffffffffffffffffffffffffff163181151561285557fe5b0490506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156128bf573d6000803e3d6000fd5b50600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015612928573d6000803e3d6000fd5b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061296d57805160ff191683800117855561299b565b8280016001018555821561299b579182015b8281111561299a57825182559160200191906001019061297f565b5b5090506129a89190612a56565b5090565b50805460018160011615610100020316600290046000825580601f106129d257506129f1565b601f0160209004906000526020600020908101906129f09190612a56565b5b50565b5060008181612a039190612a7b565b5060030160008181612a159190612a7b565b506003016000612a259190612a7b565b565b610120604051908101604052806003905b612a40612aae565b815260200190600190039081612a385790505090565b612a7891905b80821115612a74576000816000905550600101612a5c565b5090565b90565b5060008181612a8a91906129ac565b5060010160008181612a9c91906129ac565b506001016000612aac91906129ac565b565b6060604051908101604052806003905b6060815260200190600190039081612abe5790505090565b6000612ae282356132c4565b905092915050565b60008060408385031215612afd57600080fd5b6000612b0b85828601612ad6565b9250506020612b1c85828601612ad6565b9150509250929050565b612b2f816132d1565b82525050565b612b3e81613288565b82525050565b612b4d81613276565b82525050565b6000612b5e8261323b565b83602082028501612b6e85613215565b60005b84811015612ba7578383038852612b89838351612bb8565b9250612b948261325c565b9150602088019750600181019050612b71565b508196508694505050505092915050565b6000612bc382613246565b83602082028501612bd38561321f565b60005b84811015612c0c578383038852612bee838351612c1d565b9250612bf982613269565b9150602088019750600181019050612bd6565b508196508694505050505092915050565b6000612c2882613251565b808452612c3c816020860160208601613307565b612c458161333a565b602085010191505092915050565b600081546001811660008114612c705760018114612c9057612cd1565b607f600283041680865260ff198316602087015260408601935050612cd1565b60028204808652602086019550612ca685613229565b60005b82811015612cc857815481890152600182019150602081019050612ca9565b80880195505050505b505092915050565b6000601382527f69742773206e6f7420796f7572207475726e21000000000000000000000000006020830152604082019050919050565b6000602d82527f67616d654a6f696e6572206d7573742073656e642067616d65436f737420746f60208301527f2074686520636f6e7472616374000000000000000000000000000000000000006040830152606082019050919050565b6000602282527f6f6e6c792063726561746f72206861732074686520726573746172742072696760208301527f68740000000000000000000000000000000000000000000000000000000000006040830152606082019050919050565b6000602b82527f72657374617274206d7573742073656e642067616d65436f737420746f20746860208301527f6520636f6e7472616374210000000000000000000000000000000000000000006040830152606082019050919050565b6000602582527f4669656c64206e6f7420656d7074792c20796f752063616e6e6f74207365742060208301527f68657265210000000000000000000000000000000000000000000000000000006040830152606082019050919050565b6000601482527f676f206265796f6e64207468652073636f7065210000000000000000000000006020830152604082019050919050565b6000601982527f6775657374506c6179657220616c7265616479206578697374000000000000006020830152604082019050919050565b6000602b82527f796f752063616e206f6e6c79207265737461727420616674657220746865206760208301527f616d65206973206f7665720000000000000000000000000000000000000000006040830152606082019050919050565b6000602082527f67616d6543726561746f722063616e6e6f74206a6f696e207468652067616d656020830152604082019050919050565b6000601882527f7468652067616d65206973206e6f742072756e6e696e672100000000000000006020830152604082019050919050565b612fc6816132ba565b82525050565b6000602082019050612fe16000830184612b44565b92915050565b6000602082019050612ffc6000830184612b26565b92915050565b60006020820190506130176000830184612b35565b92915050565b60006040820190506130326000830185612b26565b61303f6020830184612fbd565b9392505050565b600060208201905081810360008301526130608184612b53565b905092915050565b600060208201905081810360008301526130828184612c1d565b905092915050565b600060408201905081810360008301526130a48185612c53565b90506130b36020830184612b26565b9392505050565b600060208201905081810360008301526130d381612cd9565b9050919050565b600060208201905081810360008301526130f381612d10565b9050919050565b6000602082019050818103600083015261311381612d6d565b9050919050565b6000602082019050818103600083015261313381612dca565b9050919050565b6000602082019050818103600083015261315381612e27565b9050919050565b6000602082019050818103600083015261317381612e84565b9050919050565b6000602082019050818103600083015261319381612ebb565b9050919050565b600060208201905081810360008301526131b381612ef2565b9050919050565b600060208201905081810360008301526131d381612f4f565b9050919050565b600060208201905081810360008301526131f381612f86565b9050919050565b600060208201905061320f6000830184612fbd565b92915050565b6000819050919050565b6000819050919050565b60008160005260206000209050919050565b600060039050919050565b600060039050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b60006132818261329a565b9050919050565b60006132938261329a565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b60006132dc826132e3565b9050919050565b60006132ee826132f5565b9050919050565b60006133008261329a565b9050919050565b60005b8381101561332557808201518184015260208101905061330a565b83811115613334576000848401525b50505050565b6000601f19601f830116905091905056fea265627a7a72305820bd57369393794e0ea29f675770024ea4a4c86ec4391a27f718e33379bcf7e1666c6578706572696d656e74616cf50037"
        })
        .send({
          from,
          gas: 5000000,
          value: web3.utils.toWei("0.1", "ether"),
        }).on('transactionHash',txhash=>{
        console.log('交易hash',txhash);
        iziToast.show({
          title: 'Wait',
          titleColor: "rgb(0, 255, 184)",
          message: 'The Deal is Pending...',
          messageColor: "#fff",
          progressBarColor: "rgb(0, 255, 184)",
          theme: 'dark',
          timeout: 60000,
        });
      });
      store.commit("setHostPlayer", from);
      store.commit("setContractObj", newContractObj);
      return newContractObj;
    },

    async joinGame(store, payload_joiner) {
      let contractObj = store.state.contractObj;
      let joinRes = await contractObj.methods.joinGame.send({
        from: payload_joiner,
        value: store.state.web3.utils.toWei("0.1", "ether")
      }).on('transactionHash',txhash=>{
        iziToast.show({
          title: 'Wait',
          titleColor: "rgb(0, 255, 184)",
          message: 'The Deal is Pending...',
          messageColor: "#fff",
          progressBarColor: "rgb(0, 255, 184)",
          theme: 'dark',
          timeout: 50000,
        });
      });
      store.commit("setGuestPlayer", payload_joiner);
      store.state.activePlayer = joinRes.events.ActivePlayer.returnValues.activePlayerAddr
      return joinRes;
    },
    async getActivePlayer(store) {
      let contractObj = store.state.contractObj;
      let activePlayer = await contractObj.methods.activePlayer.call();
      return activePlayer;
    },
    async getGameCost({state}) {
      let contractObj = state.contractObj;
      let gameCost = await contractObj.methods.gameCost.call();
      return gameCost;
    },

    async restartGame(store, payload_restarter) {
      let contractObj = store.state.contractObj;
      let restartRes = await contractObj.methods.restartGame.send({
        from: payload_restarter,
        value: store.state.web3.utils.toWei("0.1", "ether")
      });
      return restartRes;
    },

    async setChess(store, payload) {
      let contractObj = store.state.contractObj;
      let setChessRes = await contractObj.methods
        .setChess(payload.row, payload.column)
        .send({
          from: payload.player
        }).on('transactionHash',txhash=>{
          console.log('交易hash',txhash);
          iziToast.show({
            title: 'Wait',
            titleColor: "rgb(0, 255, 184)",
            message: 'The Deal is Pending...',
            messageColor: "#fff",
            progressBarColor: "rgb(0, 255, 184)",
            theme: 'dark',
            timeout: 40000,
          });
        });
      return setChessRes;
    },
    async getVictorPlayer(store) {
      let contractObj = store.state.contractObj;
      let victorPlayer = await contractObj.methods.victorPlayer.call();
      return victorPlayer;
    },
    async getGameResult(store) {
      let contractObj = store.state.contractObj;
      let gameResult = await contractObj.methods.gameResult.call();
      return gameResult;
    }
  }
});
